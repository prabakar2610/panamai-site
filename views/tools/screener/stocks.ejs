<!-- Stock Screener Page -->
<div class="screener-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-content">
            <div class="header-main">
                <h1 class="page-title">
                    <i class="fas fa-filter"></i>
                    Stock Screener
                </h1>
                <p class="page-subtitle">Find stocks that match your investment criteria</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-outline-primary" onclick="openSavedScreens()">
                    <i class="fas fa-bookmark"></i> Saved Screens
                </button>
                <button class="btn btn-primary" onclick="saveCurrentScreen()">
                    <i class="fas fa-save"></i> Save Screen
                </button>
            </div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
        <div class="filters-header">
            <h3>
                <i class="fas fa-sliders-h"></i>
                Filters
            </h3>
            <div class="filter-actions">
                <button class="btn btn-sm btn-ghost" onclick="resetFilters()">
                    <i class="fas fa-undo"></i> Reset
                </button>
                <button class="btn btn-sm btn-ghost" onclick="toggleFilters()">
                    <i class="fas fa-eye-slash"></i> Hide
                </button>
            </div>
        </div>

        <div class="filters-content" id="filtersContent">
            <div class="filter-tabs">
                <button class="filter-tab active" data-tab="basic">Basic</button>
                <button class="filter-tab" data-tab="fundamental">Fundamental</button>
                <button class="filter-tab" data-tab="technical">Technical</button>
                <button class="filter-tab" data-tab="performance">Performance</button>
            </div>

            <!-- Basic Filters -->
            <div class="filter-group-container" id="basic-filters">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label">Market Cap</label>
                        <select name="marketCap" class="filter-select">
                            <option value="">All</option>
                            <option value="Large" <%= filters.marketCap === 'Large' ? 'selected' : '' %>>Large Cap</option>
                            <option value="Mid" <%= filters.marketCap === 'Mid' ? 'selected' : '' %>>Mid Cap</option>
                            <option value="Small" <%= filters.marketCap === 'Small' ? 'selected' : '' %>>Small Cap</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Sector</label>
                        <select name="sector" class="filter-select">
                            <option value="">All Sectors</option>
                            <% sectors.forEach(sector => { %>
                                <option value="<%= sector %>" <%= filters.sector === sector ? 'selected' : '' %>><%= sector %></option>
                            <% }) %>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Price Range (₹)</label>
                        <div class="range-inputs">
                            <input type="number" name="minPrice" placeholder="Min" value="<%= filters.minPrice || '' %>" class="filter-input">
                            <span class="range-separator">to</span>
                            <input type="number" name="maxPrice" placeholder="Max" value="<%= filters.maxPrice || '' %>" class="filter-input">
                        </div>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Volume Range</label>
                        <div class="range-inputs">
                            <input type="number" name="minVolume" placeholder="Min" value="<%= filters.minVolume || '' %>" class="filter-input">
                            <span class="range-separator">to</span>
                            <input type="number" name="maxVolume" placeholder="Max" value="<%= filters.maxVolume || '' %>" class="filter-input">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fundamental Filters -->
            <div class="filter-group-container hidden" id="fundamental-filters">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label">P/E Ratio</label>
                        <div class="range-inputs">
                            <input type="number" name="minPE" placeholder="Min" value="<%= filters.minPE || '' %>" class="filter-input" step="0.1">
                            <span class="range-separator">to</span>
                            <input type="number" name="maxPE" placeholder="Max" value="<%= filters.maxPE || '' %>" class="filter-input" step="0.1">
                        </div>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">P/B Ratio</label>
                        <div class="range-inputs">
                            <input type="number" name="minPB" placeholder="Min" value="<%= filters.minPB || '' %>" class="filter-input" step="0.1">
                            <span class="range-separator">to</span>
                            <input type="number" name="maxPB" placeholder="Max" value="<%= filters.maxPB || '' %>" class="filter-input" step="0.1">
                        </div>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">ROE (%)</label>
                        <div class="range-inputs">
                            <input type="number" name="minROE" placeholder="Min" value="<%= filters.minROE || '' %>" class="filter-input" step="0.1">
                            <span class="range-separator">to</span>
                            <input type="number" name="maxROE" placeholder="Max" value="<%= filters.maxROE || '' %>" class="filter-input" step="0.1">
                        </div>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">ROCE (%)</label>
                        <div class="range-inputs">
                            <input type="number" name="minROCE" placeholder="Min" value="<%= filters.minROCE || '' %>" class="filter-input" step="0.1">
                            <span class="range-separator">to</span>
                            <input type="number" name="maxROCE" placeholder="Max" value="<%= filters.maxROCE || '' %>" class="filter-input" step="0.1">
                        </div>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Dividend Yield (%)</label>
                        <div class="range-inputs">
                            <input type="number" name="minDivYield" placeholder="Min" value="<%= filters.minDivYield || '' %>" class="filter-input" step="0.1">
                            <span class="range-separator">to</span>
                            <input type="number" name="maxDivYield" placeholder="Max" value="<%= filters.maxDivYield || '' %>" class="filter-input" step="0.1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Technical Filters -->
            <div class="filter-group-container hidden" id="technical-filters">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label">RSI</label>
                        <div class="range-inputs">
                            <input type="number" name="minRSI" placeholder="30" class="filter-input" min="0" max="100">
                            <span class="range-separator">to</span>
                            <input type="number" name="maxRSI" placeholder="70" class="filter-input" min="0" max="100">
                        </div>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Moving Averages</label>
                        <select name="maSignal" class="filter-select">
                            <option value="">All</option>
                            <option value="above_sma20">Above 20 SMA</option>
                            <option value="above_sma50">Above 50 SMA</option>
                            <option value="above_sma200">Above 200 SMA</option>
                            <option value="golden_cross">Golden Cross</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Price vs 52W High (%)</label>
                        <div class="range-inputs">
                            <input type="number" name="min52WHigh" placeholder="Min" class="filter-input" step="0.1">
                            <span class="range-separator">to</span>
                            <input type="number" name="max52WHigh" placeholder="Max" class="filter-input" step="0.1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Filters -->
            <div class="filter-group-container hidden" id="performance-filters">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label">Today's Performance</label>
                        <select name="performance" class="filter-select">
                            <option value="">All</option>
                            <option value="gainers" <%= filters.performance === 'gainers' ? 'selected' : '' %>>Gainers</option>
                            <option value="losers" <%= filters.performance === 'losers' ? 'selected' : '' %>>Losers</option>
                            <option value="volume" <%= filters.performance === 'volume' ? 'selected' : '' %>>High Volume</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">1D Returns (%)</label>
                        <div class="range-inputs">
                            <input type="number" name="min1DReturn" placeholder="Min" class="filter-input" step="0.1">
                            <span class="range-separator">to</span>
                            <input type="number" name="max1DReturn" placeholder="Max" class="filter-input" step="0.1">
                        </div>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">1W Returns (%)</label>
                        <div class="range-inputs">
                            <input type="number" name="min1WReturn" placeholder="Min" class="filter-input" step="0.1">
                            <span class="range-separator">to</span>
                            <input type="number" name="max1WReturn" placeholder="Max" class="filter-input" step="0.1">
                        </div>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">1M Returns (%)</label>
                        <div class="range-inputs">
                            <input type="number" name="min1MReturn" placeholder="Min" class="filter-input" step="0.1">
                            <span class="range-separator">to</span>
                            <input type="number" name="max1MReturn" placeholder="Max" class="filter-input" step="0.1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Apply Filters Button -->
            <div class="filter-actions-bottom">
                <button class="btn btn-primary" onclick="applyFilters()">
                    <i class="fas fa-search"></i>
                    Apply Filters (<span id="resultCount"><%= totalResults %></span>)
                </button>
                <button class="btn btn-outline-secondary" onclick="exportResults()">
                    <i class="fas fa-download"></i>
                    Export
                </button>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="results-section">
        <!-- Results Header -->
        <div class="results-header">
            <div class="results-info">
                <h3>Results (<%= totalResults %> stocks)</h3>
                <div class="sort-controls">
                    <label>Sort by:</label>
                    <select name="sortBy" onchange="applySorting()" class="sort-select">
                        <option value="marketCap" <%= filters.sortBy === 'marketCap' ? 'selected' : '' %>>Market Cap</option>
                        <option value="price" <%= filters.sortBy === 'price' ? 'selected' : '' %>>Price</option>
                        <option value="change" <%= filters.sortBy === 'change' ? 'selected' : '' %>>Change %</option>
                        <option value="volume" <%= filters.sortBy === 'volume' ? 'selected' : '' %>>Volume</option>
                        <option value="pe" <%= filters.sortBy === 'pe' ? 'selected' : '' %>>P/E Ratio</option>
                        <option value="pb" <%= filters.sortBy === 'pb' ? 'selected' : '' %>>P/B Ratio</option>
                        <option value="roe" <%= filters.sortBy === 'roe' ? 'selected' : '' %>>ROE</option>
                        <option value="roce" <%= filters.sortBy === 'roce' ? 'selected' : '' %>>ROCE</option>
                    </select>
                    <button class="sort-order-btn <%= filters.sortOrder === 'desc' ? 'desc' : 'asc' %>" 
                            onclick="toggleSortOrder()" 
                            title="<%= filters.sortOrder === 'desc' ? 'Descending' : 'Ascending' %>">
                        <i class="fas fa-sort-<%= filters.sortOrder === 'desc' ? 'down' : 'up' %>"></i>
                    </button>
                </div>
            </div>
            
            <div class="view-controls">
                <button class="view-btn active" data-view="table" onclick="switchView('table')">
                    <i class="fas fa-table"></i>
                </button>
                <button class="view-btn" data-view="cards" onclick="switchView('cards')">
                    <i class="fas fa-th-large"></i>
                </button>
                <button class="view-btn" data-view="list" onclick="switchView('list')">
                    <i class="fas fa-list"></i>
                </button>
            </div>
        </div>

        <!-- Results Table -->
        <div class="results-table-container" id="tableView">
            <div class="table-wrapper">
                <table class="screener-table">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="symbol">
                                Symbol
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="sortable" data-sort="name">
                                Company Name
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="sortable" data-sort="sector">
                                Sector
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="sortable" data-sort="price">
                                Price (₹)
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="sortable" data-sort="change">
                                Change %
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="sortable" data-sort="volume">
                                Volume
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="sortable" data-sort="pe">
                                P/E
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="sortable" data-sort="pb">
                                P/B
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="sortable" data-sort="roe">
                                ROE %
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="sortable" data-sort="roce">
                                ROCE %
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="sortable" data-sort="divYield">
                                Div Yield %
                                <i class="fas fa-sort"></i>
                            </th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% stocks.forEach(stock => { %>
                            <tr class="stock-row" data-symbol="<%= stock.symbol %>">
                                <td class="symbol-cell">
                                    <div class="symbol-container">
                                        <span class="symbol"><%= stock.symbol %></span>
                                        <span class="market-cap-badge <%= stock.marketCap.toLowerCase() %>">
                                            <%= stock.marketCap %>
                                        </span>
                                    </div>
                                </td>
                                <td class="name-cell">
                                    <div class="name-container">
                                        <span class="company-name"><%= stock.name %></span>
                                    </div>
                                </td>
                                <td class="sector-cell">
                                    <span class="sector-name"><%= stock.sector %></span>
                                </td>
                                <td class="price-cell">
                                    <span class="price">₹<%= stock.price.toLocaleString('en-IN', {minimumFractionDigits: 2}) %></span>
                                </td>
                                <td class="change-cell">
                                    <span class="change <%= stock.change >= 0 ? 'positive' : 'negative' %>">
                                        <%= stock.change >= 0 ? '+' : '' %><%= stock.change.toFixed(2) %>%
                                    </span>
                                </td>
                                <td class="volume-cell">
                                    <span class="volume"><%= (stock.volume / 100000).toFixed(1) %>L</span>
                                </td>
                                <td class="pe-cell">
                                    <span class="pe"><%= stock.pe.toFixed(1) %></span>
                                </td>
                                <td class="pb-cell">
                                    <span class="pb"><%= stock.pb.toFixed(1) %></span>
                                </td>
                                <td class="roe-cell">
                                    <span class="roe"><%= stock.roe.toFixed(1) %>%</span>
                                </td>
                                <td class="roce-cell">
                                    <span class="roce"><%= stock.roce.toFixed(1) %>%</span>
                                </td>
                                <td class="div-yield-cell">
                                    <span class="div-yield"><%= stock.divYield.toFixed(1) %>%</span>
                                </td>
                                <td class="actions-cell">
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline-primary" 
                                                onclick="viewStockDetails('<%= stock.symbol %>')"
                                                title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" 
                                                onclick="addToWatchlist('<%= stock.symbol %>')"
                                                title="Add to Watchlist">
                                            <i class="fas fa-star"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" 
                                                onclick="addToPortfolio('<%= stock.symbol %>')"
                                                title="Add to Portfolio">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pagination -->
        <% if (pagination.total > 1) { %>
            <div class="pagination-container">
                <div class="pagination-info">
                    Showing <%= (pagination.current - 1) * pagination.limit + 1 %> to 
                    <%= Math.min(pagination.current * pagination.limit, totalResults) %> of 
                    <%= totalResults %> results
                </div>
                <div class="pagination">
                    <% if (pagination.current > 1) { %>
                        <button class="page-btn" onclick="goToPage(<%= pagination.current - 1 %>)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    <% } %>
                    
                    <% for (let i = Math.max(1, pagination.current - 2); i <= Math.min(pagination.total, pagination.current + 2); i++) { %>
                        <button class="page-btn <%= i === pagination.current ? 'active' : '' %>" 
                                onclick="goToPage(<%= i %>)">
                            <%= i %>
                        </button>
                    <% } %>
                    
                    <% if (pagination.current < pagination.total) { %>
                        <button class="page-btn" onclick="goToPage(<%= pagination.current + 1 %>)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    <% } %>
                </div>
            </div>
        <% } %>
    </div>
</div>

<!-- Custom Styles -->
<style>
.screener-container {
    padding: var(--space-6);
    max-width: 100%;
}

.page-header {
    margin-bottom: var(--space-8);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: var(--space-6);
}

.page-title {
    font-size: var(--text-3xl);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: var(--space-2);
}

.page-subtitle {
    color: var(--text-secondary);
    font-size: var(--text-lg);
    margin: 0;
}

.header-actions {
    display: flex;
    gap: var(--space-3);
}

/* Filters Section */
.filters-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-6);
    overflow: hidden;
}

.filters-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-4) var(--space-6);
    background: var(--surface-secondary);
    border-bottom: 1px solid var(--border);
}

.filters-header h3 {
    margin: 0;
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--text-primary);
}

.filter-actions {
    display: flex;
    gap: var(--space-2);
}

.filters-content {
    padding: var(--space-6);
}

.filter-tabs {
    display: flex;
    margin-bottom: var(--space-6);
    border-bottom: 1px solid var(--border);
}

.filter-tab {
    padding: var(--space-3) var(--space-4);
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: var(--transition);
    font-weight: 500;
}

.filter-tab.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
}

.filter-tab:hover {
    color: var(--text-primary);
}

.filter-group-container {
    margin-bottom: var(--space-6);
}

.filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-4);
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.filter-label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: var(--text-sm);
}

.filter-select,
.filter-input {
    padding: var(--space-3);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    color: var(--text-primary);
    font-size: var(--text-sm);
    transition: var(--transition);
}

.filter-select:focus,
.filter-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.range-inputs {
    display: flex;
    align-items: center;
    gap: var(--space-2);
}

.range-inputs input {
    flex: 1;
}

.range-separator {
    color: var(--text-secondary);
    font-size: var(--text-sm);
}

.filter-actions-bottom {
    display: flex;
    gap: var(--space-3);
    padding-top: var(--space-6);
    border-top: 1px solid var(--border);
}

/* Results Section */
.results-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
}

.results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-4) var(--space-6);
    background: var(--surface-secondary);
    border-bottom: 1px solid var(--border);
}

.results-info {
    display: flex;
    align-items: center;
    gap: var(--space-6);
}

.results-info h3 {
    margin: 0;
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--text-primary);
}

.sort-controls {
    display: flex;
    align-items: center;
    gap: var(--space-2);
}

.sort-controls label {
    font-size: var(--text-sm);
    color: var(--text-secondary);
}

.sort-select {
    padding: var(--space-2) var(--space-3);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    color: var(--text-primary);
    font-size: var(--text-sm);
}

.sort-order-btn {
    width: 32px;
    height: 32px;
    padding: 0;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
}

.sort-order-btn:hover {
    background: var(--surface-accent);
    color: var(--text-primary);
}

.view-controls {
    display: flex;
    gap: var(--space-1);
}

.view-btn {
    width: 36px;
    height: 36px;
    padding: 0;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
}

.view-btn:first-child {
    border-radius: var(--radius) 0 0 var(--radius);
}

.view-btn:last-child {
    border-radius: 0 var(--radius) var(--radius) 0;
}

.view-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.view-btn:hover:not(.active) {
    background: var(--surface-accent);
    color: var(--text-primary);
}

/* Table Styles */
.table-wrapper {
    overflow-x: auto;
}

.screener-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--text-sm);
}

.screener-table th {
    background: var(--surface-secondary);
    padding: var(--space-3) var(--space-4);
    text-align: left;
    font-weight: 600;
    color: var(--text-primary);
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
    position: relative;
}

.screener-table th.sortable {
    cursor: pointer;
    user-select: none;
    transition: var(--transition);
}

.screener-table th.sortable:hover {
    background: var(--surface-accent);
}

.screener-table th.sortable i {
    margin-left: var(--space-1);
    opacity: 0.5;
}

.screener-table td {
    padding: var(--space-3) var(--space-4);
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
}

.stock-row:hover {
    background: var(--surface-accent);
}

.symbol-container {
    display: flex;
    align-items: center;
    gap: var(--space-2);
}

.symbol {
    font-weight: 600;
    color: var(--text-primary);
}

.market-cap-badge {
    padding: 2px 6px;
    border-radius: var(--radius-sm);
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
}

.market-cap-badge.large {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.market-cap-badge.mid {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
}

.market-cap-badge.small {
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary);
}

.company-name {
    color: var(--text-secondary);
    font-size: var(--text-xs);
}

.sector-name {
    color: var(--text-secondary);
    font-size: var(--text-xs);
}

.price {
    font-weight: 600;
    color: var(--text-primary);
}

.change {
    font-weight: 600;
    padding: 2px 6px;
    border-radius: var(--radius-sm);
}

.change.positive {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.change.negative {
    background: rgba(239, 68, 68, 0.1);
    color: var(--error);
}

.action-buttons {
    display: flex;
    gap: var(--space-1);
}

.action-buttons .btn {
    padding: var(--space-1) var(--space-2);
    font-size: var(--text-xs);
}

/* Pagination */
.pagination-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-4) var(--space-6);
    background: var(--surface-secondary);
}

.pagination-info {
    color: var(--text-secondary);
    font-size: var(--text-sm);
}

.pagination {
    display: flex;
    gap: var(--space-1);
}

.page-btn {
    width: 36px;
    height: 36px;
    padding: 0;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius);
    font-size: var(--text-sm);
}

.page-btn:hover {
    background: var(--surface-accent);
    color: var(--text-primary);
}

.page-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

/* Responsive Design */
@media (max-width: 768px) {
    .screener-container {
        padding: var(--space-4);
    }
    
    .header-content {
        flex-direction: column;
        align-items: stretch;
    }
    
    .header-actions {
        justify-content: flex-start;
    }
    
    .filter-grid {
        grid-template-columns: 1fr;
    }
    
    .results-header {
        flex-direction: column;
        gap: var(--space-4);
        align-items: stretch;
    }
    
    .results-info {
        flex-direction: column;
        gap: var(--space-3);
        align-items: stretch;
    }
    
    .sort-controls {
        justify-content: flex-start;
    }
    
    .pagination-container {
        flex-direction: column;
        gap: var(--space-3);
    }
}
</style>

<!-- JavaScript -->
<script>
// Filter tab switching
document.querySelectorAll('.filter-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        const tabName = this.dataset.tab;
        
        // Update active tab
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        // Show/hide filter groups
        document.querySelectorAll('.filter-group-container').forEach(group => {
            group.classList.add('hidden');
        });
        document.getElementById(tabName + '-filters').classList.remove('hidden');
    });
});

// Apply filters
function applyFilters() {
    const filters = {};
    
    // Collect all filter values
    document.querySelectorAll('.filter-select, .filter-input').forEach(input => {
        if (input.value) {
            filters[input.name] = input.value;
        }
    });
    
    // Add current sort settings
    const sortBy = document.querySelector('[name="sortBy"]').value;
    const sortOrder = document.querySelector('.sort-order-btn').classList.contains('desc') ? 'desc' : 'asc';
    
    filters.sortBy = sortBy;
    filters.sortOrder = sortOrder;
    
    console.log('Applying filters:', filters);
    
    // Send request to server
    fetch('/screener/api/filter', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(filters)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateResults(data.data);
        } else {
            console.error('Filter error:', data.error);
        }
    })
    .catch(error => {
        console.error('Filter request failed:', error);
    });
}

// Reset filters
function resetFilters() {
    document.querySelectorAll('.filter-select, .filter-input').forEach(input => {
        if (input.tagName === 'SELECT') {
            input.selectedIndex = 0;
        } else {
            input.value = '';
        }
    });
    
    applyFilters();
}

// Toggle filters visibility
function toggleFilters() {
    const content = document.getElementById('filtersContent');
    const isHidden = content.style.display === 'none';
    
    content.style.display = isHidden ? 'block' : 'none';
    
    const toggleBtn = document.querySelector('[onclick="toggleFilters()"]');
    toggleBtn.innerHTML = isHidden ? 
        '<i class="fas fa-eye-slash"></i> Hide' : 
        '<i class="fas fa-eye"></i> Show';
}

// Sorting functions
function applySorting() {
    applyFilters();
}

function toggleSortOrder() {
    const btn = document.querySelector('.sort-order-btn');
    const isDesc = btn.classList.contains('desc');
    
    btn.classList.toggle('desc', !isDesc);
    btn.classList.toggle('asc', isDesc);
    
    const icon = btn.querySelector('i');
    icon.className = isDesc ? 'fas fa-sort-up' : 'fas fa-sort-down';
    
    applyFilters();
}

// View switching
function switchView(viewType) {
    // Update active button
    document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[data-view="${viewType}"]`).classList.add('active');
    
    // Switch view content (implement as needed)
    console.log('Switching to view:', viewType);
}

// Pagination
function goToPage(page) {
    const filters = {};
    
    // Collect current filters
    document.querySelectorAll('.filter-select, .filter-input').forEach(input => {
        if (input.value) {
            filters[input.name] = input.value;
        }
    });
    
    filters.page = page;
    filters.sortBy = document.querySelector('[name="sortBy"]').value;
    filters.sortOrder = document.querySelector('.sort-order-btn').classList.contains('desc') ? 'desc' : 'asc';
    
    // Redirect with filters
    const params = new URLSearchParams(filters);
    window.location.href = `/screener/stocks?${params.toString()}`;
}

// Stock actions
function viewStockDetails(symbol) {
    window.open(`/stocks/${symbol}`, '_blank');
}

function addToWatchlist(symbol) {
    console.log('Adding to watchlist:', symbol);
    // Implement watchlist functionality
}

function addToPortfolio(symbol) {
    window.location.href = `/portfolio/add?symbol=${symbol}`;
}

// Export results
function exportResults() {
    console.log('Exporting results...');
    // Implement export functionality
}

// Saved screens
function openSavedScreens() {
    window.location.href = '/screener/presets';
}

function saveCurrentScreen() {
    const screenName = prompt('Enter a name for this screen:');
    if (screenName) {
        console.log('Saving screen:', screenName);
        // Implement save functionality
    }
}

// Update results function
function updateResults(data) {
    // Update result count
    document.getElementById('resultCount').textContent = data.totalResults;
    
    // Update table content (implement as needed)
    console.log('Updating results with:', data);
    
    // You can rebuild the table here or reload the page
    location.reload();
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    console.log('Stock screener initialized');
});
</script>